# HOWTO
## Содержание
+ Объяснение устройства проекта;
+ Устройство сервера;
+ Коллекции Postman.

## Объяснение устройства проекта
### Данная заготовка социальной сети состоит из Docker Compose службы, которая содержит три контейнера:
+ База данных MySQL;
+ Админка PhpMyadmin;
+ Сервер, написанный на С++.

Сервер зависит от базы данных, поэтому запустится не раньше неё. Пока база данных полностью не прогрузится и не начнёт положительно отвечать на запросы, возможны переподключения сервера к неё.

### Запуск службы
Для запуска службы, можно воспользоваться скриптом scripts\build_images.bat для сборки и scripts\run_all.bat для запуска всех служб и scripts\run_database.bat только для запуска баз. Они переходят в директорию compose и выполняют команды docker-compose build и docker-compose up -d соответственно.

## Устройство сервера
### Используемые инструменты
Данный сервер использует Conan 1.59.0 для разрешения зависимостей, conanfile.py находится в директории conan.
С помощью инструмента Conan с репозитория conancenter загружаются следующие библиотеки:
+ nlohmann_json - для работы с JSON объектами;
+ boost - сетевой стек;
+ poco - собранный с поддержкой MySQL для работы с базой данных.

### Жизненный цикл запроса
#### Запуск сервера
Входящие запросы обрабатываются классом Connection, который при получении входящего соединения создаёт отдельный поток, в котором вызывает полученный в конструкторе колбэк. Его экземпляр создаётся в классе Service, обработка входящих соединений происходит в потоках по числу логических ядер процессора.

#### Обработка входящих соединений
В качестве обработчика колбэков выступает класс Router, который содержит в себе набор контроллеров для обработки входящих соединений и последующая маршрутизация.

#### Маршрутизация
Маршрутизация происходит непосредственно в контроллерах, которые проверяют адрес запроса и либо отклоняют, после чего попытка обработки происходит следующим контроллером, либо завершается безрезультатно (если адрес не зарегистрирован).

#### Контроллеры
В данный момент реализован только функционал, связанный с деятельностью пользователей, поэтому существует только клас контроллера UsersController. В нём содержатся подконтроллеры, реализующие отдельные функции, такие как:
+ /user/get/{id};
+ /login;
+ /user/register.

#### Работа с базой данных
Контроллеры содержат в себе указатели, ссылающиеся на модели работы с таблицами, в данный момент реализованы следующие таблицы:
+ Users - хранит анкеты пользователей и их данные;
+ Tokens - хранит идентификаторы и токены пользователей для авторизации.

Контроллеры получают в запросах данные, преобразуют их в соответствующие структуры и совершают SELECT, INSERT и прочие запросы в таблицы, необходимые для реализации требуемого функционала.

## Коллекции Postman
Коллекции и окружение Postman, которые можно использовать для тестирования работы, можно найти в директории collections.
